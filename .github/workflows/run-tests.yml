name: 'Simple Branch Trigger from Azure DevOps Card'

on:
  workflow_dispatch:
    inputs:
      branch_name:
        description: 'Branch associated with the work item'
        required: true
        type: string

jobs:
  trigger-branch:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout branch
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.branch_name }}

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Check for executable code
        id: check_code
        run: |
          if [ -d "TestScriptGeneratorBOT" ] && find TestScriptGeneratorBOT -name "*.py" -type f | head -1 | grep -q .; then
            echo "has_code=true" >> $GITHUB_OUTPUT
          else
            echo "has_code=false" >> $GITHUB_OUTPUT
          fi

      - name: Execute code if available
        if: steps.check_code.outputs.has_code == 'true'
        run: |
          if [ -f "TestScriptGeneratorBOT/requirements.txt" ]; then
            pip install -r TestScriptGeneratorBOT/requirements.txt
          fi
          
          cd TestScriptGeneratorBOT
          
          if [ -f "main.py" ]; then
            python main.py
          elif find . -name "test_*.py" -type f | head -1 | grep -q .; then
            python -m pytest -v
          fi

      - name: No code execution
        if: steps.check_code.outputs.has_code == 'false'
        run: |
          echo "No code for execution"
